<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Produto | Antonella Clothing</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <header class="main-header">
    <nav class="navbar container">
      <!-- Logo -->
      <a href="index.html" class="logo">Antonella Clothing</a>

      <!-- √çcones -->
      <div class="nav-icons">
        <button id="search-toggle" aria-label="Buscar">üîç</button>
        <button id="user-btn" aria-label="Perfil">üë§</button>
        <button id="cart-icon" aria-label="Carrinho">
          üõí <span id="cart-badge" class="badge">0</span>
        </button>
      </div>
    </nav>

    <!-- Barra de busca -->
    <div class="container search-row" id="searchRow">
      <input id="globalSearch" type="text" placeholder="Buscar: vestido, blazer, bolsa..." autocomplete="off"/>
      <div id="suggestions" class="suggestions hidden"></div>
    </div>

  <!-- Modal Login -->
<div id="loginModal" class="modal-bg hidden" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h2 id="modal-title">Entrar</h2>
    <form id="loginForm">
      <div>
        <label>Email</label>
        <input type="email" id="loginEmail" required>
      </div>
      <div>
        <label>Senha</label>
        <input type="password" id="loginPassword" required>
      </div>
      <div id="registerFields" class="hidden">
        <label>Nome</label>
        <input type="text" id="registerName">
      </div>
      <button type="submit" class="btn-primary">Continuar</button>
    </form>
    <p id="toggleLogin">N√£o tem conta? <a href="#">Cadastre-se</a></p>
    <button id="closeLogin" class="btn-close">√ó</button>
  </div>
</div>


    <!-- Carrinho -->
    <aside class="cart-popup" id="cart-popup" aria-hidden="true">
      <div class="cart-header">
        <h2>Carrinho de Compras</h2>
        <button id="close-cart" class="btn-close" aria-label="Fechar carrinho">√ó</button>
      </div>
      <div id="cart-items" class="cart-items"></div>
      <div class="cart-footer">
        <div class="shipping">
          <label for="cep">Calcular Frete</label>
          <input type="text" id="cep" placeholder="Digite seu CEP (ex: 01450-000)" />
          <button type="button" class="btn-secondary" id="calculate-shipping">Calcular</button>
          <p id="shipping-cost">Frete: R$ 0,00</p>
        </div>
        <div class="payment-methods">
          <label for="payment-method">M√©todo de Pagamento</label>
          <select id="payment-method">
            <option value="cartao">Cart√£o de Cr√©dito</option>
            <option value="boleto">Boleto Banc√°rio</option>
            <option value="pix">Pix</option>
            <option value="mercadopago">Mercado Pago</option>
          </select>
        </div>
        <div class="checkout-summary">
          <p>Total: R$ <span id="cart-total">0,00</span></p>
          <button type="button" class="btn-primary" id="complete-purchase">Finalizar Compra</button>
        </div>
      </div>
    </aside>
  </header>

  <main class="container py-8">
    <div id="product-detail" class="flex flex-col md:flex-row gap-8 bg-white p-6 rounded-lg shadow-sm">
      <!-- Detalhes do produto aparecem aqui (renderizados pelo script.js) -->
    </div>
  </main>

  <footer class="main-footer">
    <div class="footer-links container">
      <div class="footer-column">
        <h4>Navega√ß√£o</h4>
        <ul>
          <li><a href="index.html">In√≠cio</a></li>
          <li><a href="index.html#colecoes">Cole√ß√µes</a></li>
          <li><a href="index.html#produtos">Produtos</a></li>
          <li><a href="index.html#sobre">Sobre</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Atendimento</h4>
        <ul>
          <li><a href="https://wa.me/5516992226122">Fale Conosco</a></li>
          <li><a href="#">Trocas e Devolu√ß√µes</a></li>
          <li><a href="#">FAQ</a></li>
          <li><a href="#">Pol√≠tica de Privacidade</a></li>
        </ul>
      </div>

      <div class="footer-column">
        <h4>Siga-nos</h4>
        <div class="social-icons">
          <a href="#" aria-label="Instagram">Instagram</a>
          <a href="#" aria-label="Pinterest">Pinterest</a>
          <a href="https://wa.me/5516992226122" aria-label="WhatsApp">WhatsApp</a>
        </div>
      </div>
    </div>

    <div class="footer-bottom container">
      <p>&copy; 2025 Antonella Clothing. Todos os direitos reservados.</p>
    </div>
  </footer>

  <style>.modal-bg {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 500;
  margin-top: 10%;
}
</style>

  <!-- Scripts -->
  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const productId = Number(params.get("id"));
      renderProductPage(productId); // usa a fun√ß√£o do script.js
    });

    // Sobrescreve renderProductPage para trocar o bot√£o
    function renderProductPage(id) {
      const container = document.getElementById("product-detail");
      const PRODUCTS = JSON.parse(localStorage.getItem("products")) || [];
      const product = PRODUCTS.find(p => p.id === id);
      if (!product) {
        container.innerHTML = "<p>Produto n√£o encontrado.</p>";
        return;
      }

      const galleryHTML = (product.images || []).map((img, i) => `
        <img src="${img}" alt="${product.title}" class="product-gallery-img ${i === 0 ? "active" : ""}"
             onclick="document.getElementById('main-product-image').src='${img}'" />
      `).join("");

      const sizeOptionsHTML = (product.sizes || []).map(s => `
        <div class="size-option" onclick="selectSize(this)">${s}</div>
      `).join("");

      container.innerHTML = `
        <div class="w-full md:w-1/2">
          <img id="main-product-image" src="${product.images[0]}" alt="${product.title}" class="w-full rounded-lg mb-4" />
          <div class="product-gallery">${galleryHTML}</div>
        </div>
        <div class="w-full md:w-1/2 space-y-6">
          <h1 class="text-3xl font-bold">${product.title}</h1>
          <div class="text-2xl font-bold text-[#b08d57]">R$ ${product.price.toFixed(2)}</div>
          <p>${product.description || ""}</p>
          ${product.sizes.length ? `
            <div><h3 class="font-semibold mb-2">Tamanhos</h3><div>${sizeOptionsHTML}</div></div>
          ` : ""}
          <div class="pt-4 border-t flex items-center space-x-4">
            <div class="flex items-center">
              <button onclick="updateQuantity(-1)" class="px-3 py-1 border rounded-l">-</button>
              <input type="number" id="quantity" value="1" min="1" max="${product.stock}" class="w-16 text-center border-t border-b">
              <button onclick="updateQuantity(1)" class="px-3 py-1 border rounded-r">+</button>
            </div>
            <!-- Bot√£o agora segue o padr√£o do index -->
            <button class="btn-primary add-btn" data-id="${product.id}">
              Adicionar ao Carrinho
            </button>
          </div>
        </div>
      `;
    }

const params = new URLSearchParams(window.location.search);
    const productId = Number(params.get("id"));
    const PRODUCTS = JSON.parse(localStorage.getItem("products")) || [];
    let CART = JSON.parse(localStorage.getItem("cart")) || [];

    function saveState() {
      localStorage.setItem("cart", JSON.stringify(CART));
    }

    function updateBadge() {
      const badge = document.getElementById("cart-badge");
      badge.textContent = CART.reduce((s, i) => s + i.qty, 0);
    }

    function renderCart() {
      const container = document.getElementById("cart-items");
      container.innerHTML = "";
      if (CART.length === 0) {
        container.innerHTML = "<p>Seu carrinho est√° vazio.</p>";
        return;
      }

      let subtotal = 0;
      CART.forEach((item, idx) => {
        subtotal += item.price * item.qty;
        const el = document.createElement("div");
        el.className = "cart-item";
        el.innerHTML = `
          <div>
            <p>${item.title}</p>
            ${item.size ? `<p>Tamanho: ${item.size}</p>` : ""}
            <p>R$ ${item.price.toFixed(2)} x ${item.qty}</p>
            <div>
              <button data-action="dec" data-idx="${idx}">-</button>
              <span style="margin:0 8px">${item.qty}</span>
              <button data-action="inc" data-idx="${idx}">+</button>
            </div>
          </div>
          <div>
            <button data-action="remove" data-idx="${idx}">Remover</button>
          </div>
        `;
        container.appendChild(el);
      });

      document.getElementById("cart-total").textContent = subtotal.toFixed(2);
    }

    function renderProductDetails(id) {
      const product = PRODUCTS.find(p => p.id === id);
      if (!product) {
        document.getElementById("product-detail").innerHTML = "<p>Produto n√£o encontrado.</p>";
        return;
      }

      const galleryHTML = product.images.map((img, i) => `
        <img src="${img}" alt="${product.title}" 
             class="product-gallery-img ${i === 0 ? "active" : ""}"
             onclick="document.getElementById('main-product-image').src='${img}'" />
      `).join("");

      const sizeOptionsHTML = product.sizes.map(s => `
        <div class="size-option" onclick="selectSize(this)">${s}</div>
      `).join("");

      document.getElementById("product-detail").innerHTML = `
        <div class="w-full md:w-1/2">
          <img id="main-product-image" src="${product.images[0]}" alt="${product.title}" class="w-full rounded-lg mb-4" />
          <div class="product-gallery">${galleryHTML}</div>
        </div>
        <div class="w-full md:w-1/2 space-y-6">
          <h1 class="text-3xl font-bold">${product.title}</h1>
          <div class="text-2xl font-bold text-[#b08d57]">R$ ${product.price.toFixed(2)}</div>
          <p>${product.description || ""}</p>
          ${product.sizes.length ? `
            <div><h3 class="font-semibold mb-2">Tamanhos</h3><div>${sizeOptionsHTML}</div></div>
          ` : ""}
          <div class="pt-4 border-t flex items-center space-x-4">
            <div class="flex items-center">
              <button onclick="updateQuantity(-1)" class="px-3 py-1 border rounded-l">-</button>
              <input type="number" id="quantity" value="1" min="1" max="${product.stock}" class="w-16 text-center border-t border-b">
              <button onclick="updateQuantity(1)" class="px-3 py-1 border rounded-r">+</button>
            </div>
            <button onclick="addToCartById(${product.id})" class="bg-[#b08d57] text-white px-6 py-2 rounded hover:bg-[#9a7b4d] transition">
              Adicionar ao Carrinho
            </button>
          </div>
        </div>
      `;
    }

    function addToCartById(id) {
      const pid = Number(id);
      const p = PRODUCTS.find(x => x.id === pid);
      if(!p) { alert('Produto n√£o encontrado'); return; }

      // üëâ Captura o tamanho escolhido
      let selectedSize = null;
      const selectedEl = document.querySelector(".size-option.selected");
      if (selectedEl) {
        selectedSize = selectedEl.textContent.trim();
      }

      // ‚ö†Ô∏è Se o produto tiver tamanhos e nenhum foi selecionado
      if (p.sizes.length && !selectedSize) {
        alert("Por favor, selecione um tamanho antes de adicionar ao carrinho.");
        return;
      }

      // Verifica se j√° existe no carrinho o mesmo produto + mesmo tamanho
      const existing = CART.find(i => i.id === pid && i.size === selectedSize);
      if(existing) {
        if(existing.qty < (p.stock || 999)) existing.qty++;
        else { alert('Estoque insuficiente'); return; }
      } else {
        CART.push({
          id: p.id,
          title: p.title,
          price: p.price,
          qty: 1,
          img: (p.images && p.images[0]) || '',
          size: selectedSize // üëà salva tamanho
        });
      }

      saveState();
      renderCart();
      updateBadge();

      const cartPopup = document.getElementById("cart-popup");
      if(cartPopup) {
        cartPopup.classList.add('active');
        cartPopup.setAttribute('aria-hidden', 'false');
      }
    }

    function selectSize(el) {
      document.querySelectorAll(".size-option").forEach(opt => opt.classList.remove("selected"));
      el.classList.add("selected");
    }

    function updateQuantity(change) {
      const input = document.getElementById("quantity");
      let newValue = parseInt(input.value) + change;
      if (newValue < 1) newValue = 1;
      if (newValue > parseInt(input.max)) newValue = parseInt(input.max);
      input.value = newValue;
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderProductDetails(productId);
      renderCart();
      updateBadge();
    });

    
    
  </script>
</body>
</html>
